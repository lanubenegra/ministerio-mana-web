
---
import TurnstileWidget from './TurnstileWidget.astro';
const cspNonce = Astro.locals?.cspNonce;
---
<footer class="mt-24 bg-[var(--mana-surface)]">
  <div class="border-t border-[var(--mana-border)] bg-accent/20">
    <div class="container-tight flex flex-col gap-4 py-8 text-center md:flex-row md:items-center md:justify-between md:text-left">
      <div>
        <p class="text-xs font-display uppercase tracking-[0.16em] text-neutral-500">Suscríbete al devocional</p>
        <h2 class="mt-1 text-lg font-display font-bold text-brand-dark">Recibe historias y noticias cada semana</h2>
      </div>
      <form id="newsletter-form" class="flex flex-col gap-3 md:flex-row md:items-center" method="post" action="/api/newsletter/subscribe">
        <input type="email" name="email" placeholder="Tu email" class="w-full rounded-full border border-[var(--mana-border-strong)] bg-white px-5 py-3 text-sm text-neutral-700 placeholder:text-neutral-400 focus:border-brand-medium focus:outline-none focus:ring-2 focus:ring-brand-medium/30 md:w-72" required />
        <TurnstileWidget appearance="interaction-only" />
        <button class="btn-primary justify-center md:px-8">Recibir devocional</button>
      </form>
    </div>
  </div>

  <div class="container-tight grid gap-10 py-12 md:grid-cols-4">
    <div class="space-y-4">
      <div class="inline-flex items-center gap-3">
        <img src="/logo.svg" alt="Ministerio Maná" class="h-8 w-auto" />
        <span class="text-sm font-display font-semibold text-brand-dark">Ministerio Maná</span>
      </div>
      <p class="text-sm text-neutral-500">Compartimos recursos, comunidad y acompañamiento para crecer en la fe y llevar esperanza a donde hace falta.</p>
      <div class="flex flex-wrap gap-2">
        <span class="pill">Fe activa</span>
        <span class="pill">Comunidad</span>
        <span class="pill">Servicio</span>
      </div>
    </div>
    <div>
      <h3 class="text-sm font-display font-semibold text-brand-dark">Explora</h3>
      <ul class="mt-3 space-y-2 text-sm text-neutral-600">
        <li><a href="/ministerio/" class="hover:text-brand-medium">Ministerio</a></li>
        <li><a href="/campus/" class="hover:text-brand-medium">Campus Maná</a></li>
        <li><a href="/escuela-biblica/" class="hover:text-brand-medium">Escuela Bíblica</a></li>
        <li><a href="/iglesias/" class="hover:text-brand-medium">Iglesias</a></li>
        <li><a href="/eventos/" class="hover:text-brand-medium">Eventos</a></li>
        <li><a href="/devocional/" class="hover:text-brand-medium">Devocional</a></li>
        <li><a href="/mujeres/" class="hover:text-brand-medium">Mujeres</a></li>
        <li><a href="/peregrinaciones/" class="hover:text-brand-medium">Peregrinaciones</a></li>
        <li><a href="/donaciones/" class="hover:text-brand-medium">Donaciones</a></li>
      </ul>
    </div>
    <div>
      <h3 class="text-sm font-display font-semibold text-brand-dark">Contacto</h3>
      <ul class="mt-3 space-y-2 text-sm text-neutral-600">
        <li><a class="hover:text-brand-medium" href="mailto:info@ministeriomana.org">info@ministeriomana.org</a></li>
        <li><a class="hover:text-brand-medium" href="mailto:media@ministeriomana.org">media@ministeriomana.org</a></li>
        <li><a class="hover:text-brand-medium" href="mailto:mujeres@ministeriomana.org">mujeres@ministeriomana.org</a></li>
        <li><a class="hover:text-brand-medium" href="mailto:campusuniversitario@ministeriomana.org">campusuniversitario@ministeriomana.org</a></li>
      </ul>
    </div>
    <div class="space-y-4">
      <h3 class="text-sm font-display font-semibold text-brand-dark">Visítanos</h3>
      <p class="text-sm text-neutral-500">Descubre próximas reuniones, grupos y eventos para conectar con la comunidad Maná.</p>
      <a href="/eventos/" class="btn-outline justify-center">Agenda de eventos</a>
    </div>
  </div>

  <div class="border-t border-[var(--mana-border)] py-6 text-center text-xs text-neutral-500">
    © {new Date().getFullYear()} Ministerio Maná · Todos los derechos reservados.
  </div>
</footer>

<script is:inline nonce={cspNonce}>
  const form = document.getElementById('newsletter-form');
  if (form) {
    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      const fd = new FormData(form);
      try {
        const res = await fetch(form.action, {
          method: 'POST',
          body: fd,
        });
        const json = await res.json();
        if (json?.ok) {
          form.reset();
          if (window.turnstile && typeof window.turnstile.reset === 'function') {
            window.turnstile.reset();
          }
          alert('¡Gracias! Revisa tu correo para confirmar la suscripción.');
        } else {
          alert(json?.error || 'No pudimos procesar tu suscripción. Intenta de nuevo.');
        }
      } catch (err) {
        alert('Error de red. Intenta nuevamente.');
      }
    });
  }
</script>
