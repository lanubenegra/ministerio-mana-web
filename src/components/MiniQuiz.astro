const id = 'quiz-' + Math.random().toString(36).slice(2);
const title = Astro.props.title || 'Mini‑quiz';
const questions = Astro.props.questions || [];
const cspNonce = Astro.locals?.cspNonce;
---
<div id={id} class="card p-4">
  <h3 class="font-semibold text-lg mb-2">{title}</h3>
  <ol class="list-decimal ml-5 space-y-3">
    {questions.map((q, qi) => (
      <li>
        <div class="font-medium">{q.q}</div>
        <div class="mt-2 grid gap-2">
          {q.options.map((opt, oi) => (
            <label class="inline-flex items-center gap-2">
              <input type="radio" name={`q${qi}`} value={oi} />
              <span>{opt}</span>
            </label>
          ))}
        </div>
      </li>
    ))}
  </ol>
  <div class="mt-4 flex gap-2">
    <button class="btn-primary" on:click={() => check()}>Revisar</button>
    <button class="btn-outline" on:click={() => share()}>Compartir</button>
  </div>
  <p id="res" class="text-sm mt-2"></p>
</div>

<script nonce={cspNonce}>
  const ans = (Astro.props.questions || []).map(q => q.a);
  function check() {
    const root = document.getElementById('${id}');
    const inputs = root.querySelectorAll('input[type=radio]:checked');
    let score = 0;
    inputs.forEach((i, idx) => { if (Number(i.value) === ans[idx]) score++; });
    root.querySelector('#res').textContent = `Tu puntaje: ${score}/${ans.length}`;
  }
  async function share() {
    const text = document.title + ' — ¡Hice el mini‑quiz en Ministeriomana.org!';
    try { await navigator.clipboard.writeText(text); alert('Texto copiado, pégalo para compartir.'); } catch {}
  }
</script>
