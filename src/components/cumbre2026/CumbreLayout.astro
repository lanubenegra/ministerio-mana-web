---
import BaseLayout from '../../layouts/BaseLayout.astro';
import NetOverlay from './NetOverlay.astro';
import AccountButton from '@components/AccountButton.astro';
import cumbreNavScript from '../../scripts/cumbre-nav.js';

const { title, description, variant = 'dark' } = Astro.props;

const isLight = variant === 'light';
const mainBg = isLight ? 'bg-slate-50 text-brand-dark' : 'bg-brand-void text-white';
const cspNonce = Astro.locals?.cspNonce;
---

<BaseLayout title={title} description={description} hideHeader hideFooter>
  <div class={`relative min-h-screen ${mainBg} overflow-hidden`}>
    <!-- Top Controls -->
    <div class="fixed top-5 left-5 right-5 z-50 flex items-center justify-between pointer-events-none">
      <a
        id="cumbre-back-link"
        href="/eventos/cumbre-mundial-2026"
        class={`pointer-events-auto inline-flex items-center gap-2 rounded-full px-4 py-2 text-xs font-bold uppercase tracking-widest border backdrop-blur-md transition ${
          isLight
            ? 'bg-white/80 border-brand-navy/10 text-brand-navy hover:bg-white'
            : 'bg-white/10 border-white/10 text-white/80 hover:text-white'
        }`}
      >
        <span aria-hidden="true">←</span>
        <span>Volver</span>
      </a>
      <div class="pointer-events-auto">
        <div class={`rounded-full border backdrop-blur-md px-2 py-1 ${isLight ? 'bg-white/70 border-brand-navy/10' : 'bg-white/10 border-white/10'}`}>
          <AccountButton />
        </div>
      </div>
    </div>
    <!-- Shared Background Effects (Dark Mode Only) -->
    {!isLight && (
      <div class="fixed inset-0 pointer-events-none z-0">
         <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-brand-void via-[#0F1623] to-black opacity-90"></div>
         <NetOverlay />
      </div>
    )}

    {isLight && (
       <div class="fixed inset-0 pointer-events-none z-0 opacity-40">
          <div class="absolute inset-0 bg-[url('/grid.svg')] opacity-[0.05]"></div>
          <div class="absolute top-0 right-0 w-[500px] h-[500px] bg-brand-gold/5 rounded-full blur-[120px]"></div>
          <div class="absolute bottom-0 left-0 w-[500px] h-[500px] bg-brand-navy/5 rounded-full blur-[100px]"></div>
       </div>
    )}

    <!-- Content -->
    <div class="relative z-10 pt-16">
      <div class="px-4 md:px-8">
        <div class="max-w-7xl mx-auto">
          <div class={`inline-flex items-center gap-2 px-4 py-2 rounded-full border backdrop-blur-md text-xs font-semibold tracking-[0.4em] uppercase ${isLight ? 'bg-white/60 border-brand-navy/10 text-brand-navy' : 'bg-white/5 border-white/10 text-brand-teal'}`}>
            Ven y Ayúdanos · Cumbre Mundial
          </div>
        </div>
      </div>
      <slot />
    </div>

    <!-- Floating WhatsApp -->
    <a 
      href="https://wa.me/573148297534" 
      target="_blank"
      rel="noopener noreferrer"
      class="fixed bottom-6 right-6 z-50 flex items-center justify-center w-14 h-14 bg-[#25D366] rounded-full shadow-lg hover:scale-110 transition-transform duration-300 group"
      aria-label="Contactar por WhatsApp"
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
      </svg>
      <!-- Tooltip -->
      <span class="absolute right-full mr-3 px-3 py-1 bg-white text-gray-800 text-xs font-bold rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
        ¿Necesitas ayuda?
      </span>
    </a>
  </div>
</BaseLayout>

<script
  type="module"
  src={cumbreNavScript}
  nonce={cspNonce}
></script>
