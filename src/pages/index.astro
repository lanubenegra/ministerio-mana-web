---
export const prerender = false;
import BaseLayout from '@layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const cumbreOnly =
  (import.meta.env?.PUBLIC_CUMBRE_ONLY ?? process.env?.PUBLIC_CUMBRE_ONLY) === 'true';

if (cumbreOnly) {
  return Astro.redirect('/eventos/cumbre-mundial-2026');
}

// Home Chapters
import HeroChapter from '@components/home/HeroChapter.astro';
import HistoryChapter from '@components/home/HistoryChapter.astro';
import WhatWeDoChapter from '@components/home/WhatWeDoChapter.astro';
import CommunityChapter from '@components/home/CommunityChapter.astro';
import CtaChapter from '@components/home/CtaChapter.astro';

// Data Fetching
const eventsAll = (await getCollection('events')).sort((a, b) => a.data.date.localeCompare(b.data.date));
const upcoming = eventsAll.slice(0, 3);
const nextEvent = upcoming.length > 0 ? upcoming[0] : null;

// Prepare prop for Hero
const heroEvent = nextEvent ? {
  title: nextEvent.data.title,
  date: new Date(nextEvent.data.date),
  category: nextEvent.data.category,
  summary: nextEvent.data.summary,
  slug: nextEvent.slug
} : undefined;
---

<BaseLayout title="Ministerio Maná — Bienvenido" description="Iglesias, devocionales, Campus Maná, Escuela Bíblica y eventos.">
  <link rel="stylesheet" href="/src/styles/global.css" />
  
  <!-- Scripts para efectos visuales (se mantienen si son necesarios para el scroll behavior global) -->
  <script src="/js/scroll-story.js" defer></script>
  <script src="/js/history-scroll.js" defer></script>

  <main class="overflow-x-hidden">
    <HeroChapter upcomingEvent={heroEvent} />
    <HistoryChapter />
    <WhatWeDoChapter />
    <CommunityChapter />
    <CtaChapter />
  </main>
</BaseLayout>
